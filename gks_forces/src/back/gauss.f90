real*8 FUNCTION GASDEV(IDUM)
save
integer idum,iset
real*8 v1,v2,r,fac,gset,ran1
DATA ISET/0/    
IF (ISET.EQ.0) THEN
1 V1=2.0d0*RAN1(IDUM)-1.0d0
  V2=2.0d0*RAN1(IDUM)-1.0d0
  R=V1**2+V2**2 
  IF(R.GE.1.0d0)GO TO 1
  FAC=SQRT(-2.0d0*LOG(R)/R)
  GSET=V1*FAC   
  GASDEV=V2*FAC
  ISET=1
ELSE   
  GASDEV=GSET
  ISET=0    
ENDIF  
RETURN
END  

real*8 FUNCTION RAN1(IDUM)
save
integer idum,m1,m2,m3,ia1,ia2,ia3,ic1,ic2,ic3,iff
integer ix1,ix2,ix3,j
real*8 R,rm1,rm2
DIMENSION R(97)
PARAMETER (M1=139968,IA1=3877,IC1=29573,RM1=1.0d0/M1)
PARAMETER (M2=214326,IA2=3613,IC2=45289,RM2=1.0d0/M2)
PARAMETER (M3=714025,IA3=1366,IC3=150889)
DATA IFF /0/
IF (IDUM.LT.0.OR.IFF.EQ.0) THEN
  IFF=1
  IX1=MOD(IC1-IDUM,M1)
  IX1=MOD(IA1*IX1+IC1,M1)
  IX2=MOD(IX1,M2)
  IX1=MOD(IA1*IX1+IC1,M1)
  IX3=MOD(IX1,M3)
  DO J=1,97
    IX1=MOD(IA1*IX1+IC1,M1)
    IX2=MOD(IA2*IX2+IC2,M2)
    R(J)=(dble(IX1)+dble(IX2)*RM2)*RM1
  ENDDO
  IDUM=1
ENDIF
IX1=MOD(IA1*IX1+IC1,M1)
IX2=MOD(IA2*IX2+IC2,M2)
IX3=MOD(IA3*IX3+IC3,M3)
J=1+(97*IX3)/M3
IF(J.GT.97.OR.J.LT.1)PAUSE
RAN1=R(J)
R(J)=(dble(IX1)+dble(IX2)*RM2)*RM1
RETURN
END
